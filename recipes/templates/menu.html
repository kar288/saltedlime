{% extends "recipeBase.html" %}

{% block title %}
Menu
{% endblock %}

{% block content %}
  <div class="centered medium">
    <h4>
      Menu
    </h4>
    <div class="row">
      <div class="col s12 m6">
        <div class="ui-widget">
          <label for="note-title">Note: </label>
          <input id="note-title">
        </div>
        {% for note in notes %}
          <a class="menu-recipe" note-id="{{note.id}}" href="{% url 'note' note.id %}">
            {{note.title}}
          </a>
          <br>
        {% endfor %}
      </div>
      <div class="col s12 m6">
        {% for name, units in ingredients.items %}
          <div class="menu-ingredient" id="ingredient-{{forloop.counter}}">
            <b>{{name}}</b>
            {% for unit, quantities in units.items %}
             {{quantities.total}} {{unit}}
             {% if not forloop.last %}
             ,
             {% endif %}
            {% endfor %}
          </div>
          <div class="hidden" ingredient="ingredient-{{forloop.counter}}">
            {% for unit, quantities in units.items %}
              <h5>{{quantities.total}} {{unit}}</h5>
              {% for q in quantities.details %}
                <div class="row">
                  <div class="tooltipped col s6"
                    data-position="bottom"
                    data-delay="1000"
                    data-tooltip="{{q.quantity}}">
                    {{q.string}}
                  </div>
                  <div class="col s6">
                    <a href="{% url 'note' q.note %}">
                      {{q.title}}
                    </a>
                  </div>
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  <script>
    $(function() {
      $('#note-title').autocomplete({
        serviceUrl: '/note-autocomplete',
        minLength: 2,
        transformResult: function(data) {
          return JSON.parse(data);
        },
        onSelect: function(suggestion) {
          debugger;
          var ids = 'id=' + suggestion.id;
          $('.menu-recipe').each(function() {
            ids += '&id=' + $(this).attr('note-id');
          });
          document.location.href = '/menu/?' + ids;
        }
      });
    });

    $('.menu-ingredient').on('click', function() {
      $('[ingredient="' + $(this).attr('id') + '"]').toggleClass('hidden');
    });
  </script>
{% endblock %}
